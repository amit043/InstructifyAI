ID,Epic,Title,Description,AcceptanceCriteria,DoD,Files,Tests,PR
C10-00,Parser++ (Celery),Worker deps & Docker base,"Install tesseract-ocr, add Python deps (pymupdf, pytesseract, charset-normalizer, bs4, lxml, httpx). Build worker image with these layers.","Worker container builds successfully; tesseract --version logs in startup; Python libs import without error.","Dockerfile.worker updated; compose overrides ok; README notes Windows/WSL step.",docker/Dockerfile.worker; docker-compose.yml; README.md,tests/test_worker_imports.py,[C10-00] Worker deps (tesseract + libs)
C10-01,Parser++ (Celery),Celery Canvas orchestrator skeleton,"Introduce chain/group/chord flow: preflight → normalize → extract → (optional OCR fan-out) → structure → chunk+write → finalize.","Calling orchestration schedules tasks; status transitions persisted; per-stage audits with request_id.","Idempotent writes to /derived; small flow unit test with fakes.",worker/flow.py; worker/tasks/*.py; core/correlation.py,tests/test_orchestrator_flow.py,[C10-01] Celery Canvas orchestrator
C10-02,Parser++ (Celery),Preflight & normalization,"Detect mime/encoding; normalize to UTF-8, NFKC; strip control chars; standardize newlines; record metrics (control_char_count, non_utf8_ratio).","Preflight+normalize returns payload+metrics; bad encodings handled; metrics written to DocumentVersion.meta.parse.",parser_pipeline/preflight.py; parser_pipeline/normalize.py,parser_pipeline/preflight.py; parser_pipeline/normalize.py,tests/test_preflight_normalize.py,[C10-02] Preflight & normalization
C10-03,Parser++ (Celery),PDF v2 with OCR fallback,"PyMuPDF text per page; if text_len<50 & images>0 → OCR via pytesseract (DPI 300, lang from project settings). Merge text; keep ocr_conf_mean.","Text-only PDFs skip OCR; scanned pages gain text; per-page metrics stored; blocks include page + source_stage.",parsers/pdf_v2.py,parsers/pdf_v2.py,tests/test_pdf_v2_ocr.py,[C10-03] PDF extractor v2 + OCR
C10-04,Parser++ (Celery),UTF/char coverage metrics,"Compute ascii/latin1/other ratios & invalids removed; store before/after extraction.","Ratios visible in DocumentVersion.meta.parse; unit tests cover edge unicode.",parser_pipeline/metrics.py,parser_pipeline/metrics.py,tests/test_char_coverage.py,[C10-04] UTF coverage metrics
C10-05,Parser++ (Celery),HTML bundle (ZIP) ingest + parse,"POST /ingest/zip stores bundle.zip; worker unzips temp, traverses *.html; parse each via BeautifulSoup; emit blocks with file_path.","Chunks/JSONL include file_path; manifest lists files; MinIO derived present.",api/main.py; parsers/html_bundle.py; storage/object_store.py,api/main.py; parsers/html_bundle.py; storage/object_store.py,tests/test_ingest_zip_bundle.py,[C10-05] HTML ZIP ingest + parse
C10-06,Parser++ (Celery),HTML crawl ingest (URI set),"POST /ingest/crawl {base_url, allow_prefix, max_depth, max_pages}; httpx fetch; same-host, prefix-constrained; store crawl_index.json; parse pages.","Multi-page doc created; chunks include file_path+url; rate limiting & dedupe handled.",api/main.py; parsers/html_crawl.py,api/main.py; parsers/html_crawl.py,tests/test_ingest_crawl.py,[C10-06] HTML crawl ingest + parse
C10-07,Parser++ (Celery),Structure inference v2,"Titles: font-size heuristic (PDF), h1..h6 (HTML); tables → table_placeholder; build section_path.","Blocks carry kind, section_path; table placeholders present where expected.",parser_pipeline/structure.py,parser_pipeline/structure.py,tests/test_structure_infer.py,[C10-07] Structure inference v2
C10-08,Parser++ (Celery),Chunker v2 (multi-file aware),"Respect file_path & title boundaries; ~900-token max; deterministic splits.","Chunk meta contains file_path,page,section_path; golden determinism test.",chunking/chunker_v2.py,chunking/chunker_v2.py,tests/test_chunker_v2.py,[C10-08] Chunker v2
C10-09,Parser++ (Celery),Derived writer + manifest v2,"Write chunks.jsonl and manifest.json: tool_versions, thresholds, stage_metrics, files, pages_ocr; presign URLs.","Manifest present with expected fields; presigned URLs returned; lineage reproducible.",worker/derived_writer.py; storage/object_store.py,worker/derived_writer.py; storage/object_store.py,tests/test_manifest_v2.py,[C10-09] Manifest & lineage
C10-10,Parser++ (Celery),Metrics & quality gates update,"Add text_coverage, ocr_ratio, utf_other_ratio; mark needs_review if thresholds breached; surface in /documents.","Toggling thresholds changes result; tests for pass/fail.",core/metrics.py; worker/main.py; api/main.py,core/metrics.py; worker/main.py; api/main.py,tests/test_quality_gates_v2.py,[C10-10] Metrics + gates v2
C10-11,Parser++ (Celery),Project settings for parser thresholds/lang,"Extend project settings: ocr_langs, min_text_len_for_ocr, html_crawl_limits. Worker reads on each task.","PATCH /projects/{id}/settings updates behavior without redeploy.",api/schemas.py; api/main.py; core/settings.py; worker/pipeline.py,api/schemas.py; api/main.py; core/settings.py; worker/pipeline.py,tests/test_parser_settings.py,[C10-11] Parser settings wiring
C10-12,Parser++ (Celery),E2E golden set & scorecard update,"Add example ZIP & mixed PDF; scorecard validates gates; make target runs end-to-end.","make scorecard passes on golden; CI smoke added.",examples/bundles/*; scripts/scorecard.py; Makefile,examples/bundles/*; scripts/scorecard.py; Makefile,tests/test_scorecard_e2e.py,[C10-12] Golden set + scorecard
C10-13,Parser++ (Celery),Observability & backpressure,"Per-stage audits, request_id propagation; Celery routing (q=ocr) & concurrency caps; doc status per stage.","Logs show request_id; audits written; OCR queue capped via compose.",core/correlation.py; worker/celery_app.py; docker-compose.yml,core/correlation.py; worker/celery_app.py; docker-compose.yml,tests/test_request_id_and_routing.py,[C10-13] Observability + queues
